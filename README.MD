# PHP REST API com JWT e MySQL

![PHP](https://img.shields.io/badge/PHP-8.0%2B-blue)
![MySQL](https://img.shields.io/badge/MySQL-5.7%2B-orange)
![JWT](https://img.shields.io/badge/JWT-Authentication-green)
![REST](https://img.shields.io/badge/REST-API-yellow)

Uma API REST elegante e poderosa construÃ­da com PHP puro, utilizando autenticaÃ§Ã£o JWT e banco de dados MySQL. Este projeto implementa um CRUD completo seguindo boas prÃ¡ticas de desenvolvimento.

## ğŸš€ Funcionalidades

- âœ… Sistema de autenticaÃ§Ã£o com JWT
- âœ… OperaÃ§Ãµes CRUD para usuÃ¡rios
- âœ… Arquitetura organizada e escalÃ¡vel
- âœ… Middleware de autenticaÃ§Ã£o
- âœ… Sistema de migrations
- âœ… ValidaÃ§Ã£o de dados
- âœ… Gerenciamento de erros

## ğŸ“š Estrutura do Projeto

```
user_restfull-api/
â”œâ”€â”€ .env                    # VariÃ¡veis de ambiente (nÃ£o incluir no git)
â”œâ”€â”€ .env.example            # Exemplo das variÃ¡veis necessÃ¡rias
â”œâ”€â”€ .gitignore              # Arquivos a ignorar no git
â”œâ”€â”€ .htaccess               # ConfiguraÃ§Ãµes de rewrite para URLs amigÃ¡veis
â”œâ”€â”€ composer.json           # DependÃªncias do projeto
â”œâ”€â”€ index.php               # Ponto de entrada da aplicaÃ§Ã£o e router
â”œâ”€â”€ migrate.php             # Script para executar migrations
â”œâ”€â”€ config/
â”‚   â””â”€â”€ Database.php        # ConfiguraÃ§Ã£o da conexÃ£o com o banco de dados
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ AuthController.php  # Controlador para autenticaÃ§Ã£o
â”‚   â””â”€â”€ UserController.php  # Controlador para operaÃ§Ãµes de usuÃ¡rios
â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ Migration.php       # Classe base para migrations
â”‚   â”œâ”€â”€ MigrationManager.php # Gerenciador de migrations
â”‚   â””â”€â”€ CreateUsersTable.php # Migration para criar tabela de usuÃ¡rios
â”œâ”€â”€ models/
â”‚   â””â”€â”€ User.php            # Modelo de dados de usuÃ¡rio
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ JwtHandler.php      # Classe para gerenciamento de JWT
â””â”€â”€ middleware/
    â””â”€â”€ AuthMiddleware.php  # Middleware para verificaÃ§Ã£o de autenticaÃ§Ã£o
```

## ğŸ“‹ PrÃ©-requisitos

- XAMPP com PHP 8.0 ou superior
- MySQL 5.7 ou superior (incluÃ­do no XAMPP)
- Composer

## âš™ï¸ InstalaÃ§Ã£o e ConfiguraÃ§Ã£o com XAMPP

### 1. Preparar o diretÃ³rio do projeto
Coloque os arquivos do projeto em `C:\xampp\htdocs\user_restfull-api\` (Windows) ou `/opt/lampp/htdocs/user_restfull-api/` (Linux).

### 2. Instalar dependÃªncias com Composer
Abra o terminal/prompt de comando, navegue atÃ© a pasta do projeto e execute:
```bash
cd C:\xampp\htdocs\user_restfull-api
composer install
```

### 3. Configurar variÃ¡veis de ambiente
Crie um arquivo `.env` na raiz do projeto:

```bash
# Copie o arquivo .env.example
cp .env.example .env
```

Edite o arquivo `.env` com suas configuraÃ§Ãµes:
```
DB_HOST=localhost
DB_NAME=api_db
DB_USER=root
DB_PASSWORD=
JWT_SECRET=sua_chave_secreta_muito_segura
```

### 4. Criar o banco de dados
Acesse o phpMyAdmin em `http://localhost/phpmyadmin` e execute:

```sql
CREATE DATABASE api_db;
```

Ou use o MySQL por linha de comando:
```bash
mysql -u root -p
CREATE DATABASE api_db;
EXIT;
```

### 5. Executar as migrations

#### Via linha de comando (recomendado):
```bash
php migrate.php
```

#### Via navegador:
Acesse `http://localhost/user_restfull-api/migrate.php` no seu navegador.

## ğŸ› ï¸ Sistema de Migrations

Este projeto inclui um sistema de migrations que permite criar e gerenciar a estrutura do banco de dados de forma controlada.

### Executar as migrations
```bash
php migrate.php
```

### Reverter a Ãºltima migration
```bash
php migrate.php rollback
```

### Criar uma nova migration
1. Crie uma nova classe em `migrations/` que estenda a classe `Migration`
2. Implemente os mÃ©todos `up()` (para criar/alterar) e `down()` (para reverter)
3. Registre sua migration no arquivo `migrations/MigrationManager.php`

Exemplo de uma nova migration:

```php
<?php
namespace Api\Migrations;

class CreateProductsTable extends Migration
{
    public function up()
    {
        $query = "
        CREATE TABLE IF NOT EXISTS products (
            id INT AUTO_INCREMENT PRIMARY KEY,
            name VARCHAR(100) NOT NULL,
            description TEXT,
            price DECIMAL(10,2) NOT NULL,
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
        )";
        
        try {
            $this->conn->exec($query);
            return true;
        } catch (\PDOException $e) {
            echo "Erro ao criar tabela products: " . $e->getMessage();
            return false;
        }
    }
    
    public function down()
    {
        $query = "DROP TABLE IF EXISTS products";
        
        try {
            $this->conn->exec($query);
            return true;
        } catch (\PDOException $e) {
            echo "Erro ao remover tabela products: " . $e->getMessage();
            return false;
        }
    }
}
```

Depois, adicione a nova migration ao MigrationManager:

```php
// Em MigrationManager.php
$this->migrations = [
    CreateUsersTable::class,
    CreateProductsTable::class  // Nova migration
];
```

## ğŸ§ª Testando a API no XAMPP

### ConfiguraÃ§Ã£o do XAMPP

1. **Certifique-se que o mod_rewrite estÃ¡ habilitado**:
   - No painel do XAMPP, clique em "Config" ao lado do Apache
   - Escolha "Apache (httpd.conf)"
   - Verifique se a linha `LoadModule rewrite_module modules/mod_rewrite.so` estÃ¡ sem # no inÃ­cio
   - Certifique-se que na configuraÃ§Ã£o do diretÃ³rio htdocs esteja `AllowOverride All`
   - Reinicie o Apache

2. **CorreÃ§Ã£o de URLs para subdiretÃ³rios**:
   Se o projeto estÃ¡ num subdiretÃ³rio como `user_restfull-api`, certifique-se que o roteamento do `index.php` estÃ¡ considerando esse subdiretÃ³rio.

### Testando os endpoints

Use ferramentas como Postman, Insomnia ou curl para testar a API.

1. **Registrar um usuÃ¡rio**
```http
POST http://localhost/user_restfull-api/auth/register
Content-Type: application/json

{
  "name": "UsuÃ¡rio Teste",
  "email": "usuario@teste.com",
  "password": "senha123"
}
```

2. **Fazer login**
```http
POST http://localhost/user_restfull-api/auth/login
Content-Type: application/json

{
  "email": "usuario@teste.com",
  "password": "senha123"
}
```
Resposta:
```json
{
  "status": 1,
  "message": "Login realizado com sucesso",
  "token": "eyJ0eXAiOiJKV...",
  "user": {
    "id": 1,
    "name": "UsuÃ¡rio Teste",
    "email": "usuario@teste.com"
  }
}
```

3. **Listar usuÃ¡rios** (requer token)
```http
GET http://localhost/user_restfull-api/users
Authorization: Bearer seu_token_jwt
```

4. **Obter um usuÃ¡rio especÃ­fico** (requer token)
```http
GET http://localhost/user_restfull-api/users/1
Authorization: Bearer seu_token_jwt
```

5. **Atualizar usuÃ¡rio** (requer token)
```http
PUT http://localhost/user_restfull-api/users/1
Content-Type: application/json
Authorization: Bearer seu_token_jwt

{
  "name": "Nome Atualizado",
  "email": "email@atualizado.com"
}
```

6. **Excluir usuÃ¡rio** (requer token)
```http
DELETE http://localhost/user_restfull-api/users/1
Authorization: Bearer seu_token_jwt
```

## ğŸ”’ SeguranÃ§a

### Boas prÃ¡ticas implementadas
- Armazenamento de senhas com hash seguro (password_hash)
- AutenticaÃ§Ã£o com JWT
- ValidaÃ§Ã£o de dados de entrada
- UtilizaÃ§Ã£o de variÃ¡veis de ambiente para credenciais sensÃ­veis
- Sistema de migrations controlado

### SugestÃµes para melhorias adicionais
- Implementar HTTPS em produÃ§Ã£o
- Configurar CORS adequadamente
- Adicionar rate limiting para prevenir ataques de forÃ§a bruta
- Implementar logs detalhados

## ğŸ§© Como estender o projeto

### Adicionar novos recursos

Para adicionar um novo recurso (ex: "produtos"):

1. Crie uma nova migration:
```php
// migrations/CreateProductsTable.php
// (Ver exemplo acima)
```

2. Adicione a migration ao MigrationManager e execute-a:
```bash
php migrate.php
```

3. Crie o modelo em `models/Product.php`
4. Crie o controlador em `controllers/ProductController.php`
5. Adicione as rotas em `index.php`

## ğŸ“š ResoluÃ§Ã£o de problemas comuns

### Erro 404 - PÃ¡gina nÃ£o encontrada
- Verifique se o mÃ³dulo rewrite estÃ¡ ativado no Apache
- Confirme que o arquivo .htaccess estÃ¡ na raiz do projeto
- Verifique se a configuraÃ§Ã£o `AllowOverride All` estÃ¡ definida no httpd.conf
- Verifique se o router estÃ¡ lidando corretamente com o subdiretÃ³rio do projeto

### Erro "Recurso nÃ£o encontrado"
- Verifique se a URL estÃ¡ correta, incluindo o nome do subdiretÃ³rio
- Confirme se o router estÃ¡ processando corretamente a URL, removendo o nome do subdiretÃ³rio antes de procurar pelas rotas

### Erro de autenticaÃ§Ã£o
- Verifique se o token JWT estÃ¡ sendo enviado corretamente no cabeÃ§alho
- Confirme se a chave secreta JWT Ã© a mesma usada para gerar e validar tokens
- Verifique se o token nÃ£o estÃ¡ expirado

### Erro de conexÃ£o com o banco de dados
- Confirme que as credenciais no arquivo .env estÃ£o corretas
- Verifique se o serviÃ§o MySQL estÃ¡ em execuÃ§Ã£o
- Confirme que o banco de dados existe

## ğŸ¤ ContribuiÃ§Ãµes

ContribuiÃ§Ãµes sÃ£o bem-vindas! Sinta-se Ã  vontade para abrir issues ou enviar pull requests.


